import{_ as $,u as U,k as G,l as S,m as K,o as d,c as u,a as s,t as x,n as l,A as j,e as m,q as f,s as q,v as M,b as R,C as L,x as Q,y as z,z as J,f as y,B as i,D as F,E as V,G as W,p as X,h as Y}from"./index-BmrBjj-O.js";import{M as Z}from"./index-BMSQkwth.js";const ee={class:"admin-page"},te={key:0,class:"post-block admin-empty"},se={key:1,class:"post-block admin-editor"},ae={class:"admin-editor__bar"},ne={class:"admin-editor__left"},le=["title"],oe={class:"admin-editor__hint"},ie={key:0,class:"admin-editor__hint"},de={key:1,class:"admin-editor__hint"},ue={key:2,class:"admin-editor__hint"},re={key:3,class:"admin-editor__hint"},ve={class:"admin-editor__actions"},ce=["disabled"],me=["disabled"],_e={class:"admin-editor__grid"},pe={class:"admin-panel"},fe={class:"admin-fields"},ye={class:"field"},ge={class:"field field--textarea"},be={class:"admin-preview"},we=["innerHTML"],ke={__name:"AdminView",setup(he){const g=U(),b=G(),a=y(()=>{const t=g.query.slug;return String(Array.isArray(t)?t[0]:t||"").trim()}),o=j,w=i(!1),_=i(null),k=i(!1),p=i(""),E=y(()=>(X.value,a.value?Y(a.value):null)),T=y(()=>o?_.value:E.value);async function A(){if(!o)return;const t=a.value;if(!t){_.value=null;return}k.value=!0,p.value="";try{_.value=await J(t)}catch(e){p.value=e?.message||String(e),_.value=null}finally{k.value=!1}}S(a,A,{immediate:!0}),S(K,A);const r=i(""),v=i(""),c=i(!1),h=i(""),P=i(!1);S(T,t=>{r.value=t?.title||"",h.value=t?.date==="未设置日期"?"":t?.date||"",v.value=t?.content||"",c.value=!1},{immediate:!0});async function C(t,e){const n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e||{})}),D=await n.json().catch(()=>({}));if(!n.ok)throw new Error(D?.error||"Request failed");return D}async function B(){if(a.value)try{const t={slug:a.value,title:r.value,content:v.value},e=o?await F(t):await C("/__admin/save",t);if(c.value=!1,e?.date&&(h.value=e.date),e?.slug&&e.slug!==a.value){const n={...g.query,slug:e.slug};await b.replace({name:"admin",query:n})}V()}catch(t){window.alert(t?.message||String(t))}}async function H(){if(a.value)try{o?await W(a.value):await C("/__admin/delete",{slug:a.value});const t={...g.query};delete t.slug,await b.replace({name:"admin",query:t}),V()}catch(t){window.alert(t?.message||String(t))}}function I(){a.value&&window.open(b.resolve({name:"post",params:{slug:a.value}}).href,"_blank")}const N=new Z({html:!1,linkify:!0,typographer:!0,breaks:!0}),O=y(()=>N.render(v.value||""));return(t,e)=>(d(),u("div",ee,[a.value?(d(),u("div",se,[s("div",ae,[s("div",ne,[s("div",{class:"admin-editor__title",title:a.value},x(r.value||a.value),9,le),s("div",oe," 更新时间："+x(h.value||"未保存")+"（保存时自动更新到秒） ",1),l(o)?(d(),u("div",ie," 远程模式：保存/删除会提交到 GitHub 仓库（src/posts/）。如果你启用了 GitHub Actions 部署 Pages，通常 1-2 分钟后站点会更新。 ")):m("",!0),l(o)&&!l(f)?(d(),u("div",de,"请先设置管理密钥。")):m("",!0),l(o)&&k.value?(d(),u("div",ue,"加载中...")):m("",!0),l(o)&&p.value?(d(),u("div",re,x(p.value),1)):m("",!0)]),s("div",ve,[l(o)?(d(),u("button",{key:0,class:"btn",type:"button",onClick:e[0]||(e[0]=n=>w.value=!0)},"密钥")):m("",!0),s("button",{class:"btn",type:"button",onClick:I},"查看"),s("button",{class:"btn",type:"button",disabled:!c.value||l(o)&&!l(f),onClick:B}," 保存 ",8,ce),s("button",{class:"btn btn--danger",type:"button",disabled:l(o)&&!l(f),onClick:e[1]||(e[1]=n=>P.value=!0)}," 删除 ",8,me)])]),s("div",_e,[s("div",pe,[s("div",fe,[s("label",ye,[e[9]||(e[9]=s("span",{class:"field__label"},"标题",-1)),q(s("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>r.value=n),class:"field__input",type:"text",onInput:e[3]||(e[3]=n=>c.value=!0)},null,544),[[M,r.value]])])]),s("label",ge,[e[10]||(e[10]=s("span",{class:"field__label"},"内容",-1)),q(s("textarea",{"onUpdate:modelValue":e[4]||(e[4]=n=>v.value=n),class:"field__textarea",rows:"18",spellcheck:"false",onInput:e[5]||(e[5]=n=>c.value=!0)},null,544),[[M,v.value]])])]),s("div",be,[e[11]||(e[11]=s("div",{class:"admin-preview__title"},"预览",-1)),s("div",{class:"markdown",innerHTML:O.value},null,8,we)])])])):(d(),u("div",te,[...e[8]||(e[8]=[s("h1",{class:"admin-empty__title"},"管理模式",-1),s("div",{class:"admin-empty__desc"},"在左侧选择文章，或点击“新建”创建一篇新文章。",-1)])])),R(L,{open:P.value,"onUpdate:open":e[6]||(e[6]=n=>P.value=n),title:"确认删除",message:`确认删除「${String(r.value.trim()||a.value||"").trim()}」？`,"confirm-text":"删除",danger:!0,onConfirm:H},null,8,["open","message"]),R(z,{open:w.value,"onUpdate:open":e[7]||(e[7]=n=>w.value=n),value:l(f),onSave:l(Q)},null,8,["open","value","onSave"])]))}},xe=$(ke,[["__scopeId","data-v-588951de"]]);export{xe as default};
